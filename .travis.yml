language: ruby
sudo: false

branches:
  only: master

cache:
- bundler
- apt

script: 
- bundle exec gem build gollum-site.gemspec
- bundle exec gem install gollum-site-0.1.12.KMS.gem
- bundle show gollum-site
- bundle exec gollum-site
- export BUNDLE_GEMFILE=$PWD/Gemfile
- echo $BUNDLE_GEMFILE
- pwd
- ls
- cd ../
- mkdir wiki-pages
- git clone https://github.com/Kevin-M-Smith/wiki.wiki.git
- cd wiki.wiki
- export WIKI_VERISON=`git rev-parse HEAD`
- export COMMIT_MESSAGE="Built from "$WIKI_VERSION
- bundle exec gollum-site generate --output_path ../wiki-pages/
- cd ../wiki-pages
- ls
- git init
- git config user.name "Kevin M. Smith"
- git config user.email "kms2227@columbia.edu"
- git add . 
- git commit -m $COMMIT_MESSAGE
- git push --force --quiet "https://${GH_TOKEN}@github.com/Kevin-M-Smith/wiki.git" gh-pages

env:
  global:
    secure: "AzPDZG6e5yDiyqfRfrGi4R+WWdWrVpVa0/4kIq1qjXkyN6+t0hsU2qCmUmvgMS7ebvl87xh1mkLu7lK18gFV3KFF3q468kXTaefCZHTuW3X5yHUvrQX978ota+L+vq+UbKbHy3n9aORF/Cx+xrZCqpZGRcqJbUGxgQGGDYr1kEQ="
